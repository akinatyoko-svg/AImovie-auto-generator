name: Generate Video (ComfyUI)

on:
  workflow_dispatch:
    inputs:
      prompt:
        description: "Positive prompt text"
        required: true
        type: string
      negative:
        description: "Negative prompt text"
        required: false
        default: ""
        type: string
      host:
        description: "ComfyUI base URL"
        required: false
        default: "http://192.168.1.3:8188"
        type: string
      count:
        description: "Number of videos to generate"
        required: false
        default: "5"
        type: string
      timeout:
        description: "Timeout seconds per video"
        required: false
        default: "3600"
        type: string

jobs:
  generate:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Generate video
        run: |
          python3 comfy_video_generate.py \
            --host "${{ inputs.host }}" \
            --prompt "${{ inputs.prompt }}" \
            --negative "${{ inputs.negative }}" \
            --out comfy_video \
            --count "${{ inputs.count }}" \
            --timeout "${{ inputs.timeout }}"
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: comfy_video
          path: comfy_video_*.mp4
